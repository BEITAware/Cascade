<UserControl x:Class="Cascade.Views.OperationsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Cascade.Views"
             xmlns:vm="clr-namespace:Cascade.ViewModels"
             xmlns:vmOps="clr-namespace:Cascade.ViewModels.Operations"
             xmlns:models="clr-namespace:Cascade.Models.Operations"
             xmlns:helpers="clr-namespace:Cascade.Helpers"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">

    <UserControl.DataContext>
        <vm:OperationsViewModel/>
    </UserControl.DataContext>

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Cascade;component/Styles/AeroControls.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- 转换器 -->
            <helpers:NullToVisibilityConverter x:Key="NullToVisibleConverter"/>
            <helpers:NullToCollapsedConverter x:Key="NullToCollapsedConverter"/>
            <helpers:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
            <helpers:CountToInverseVisibilityConverter x:Key="CountToInverseVisibilityConverter"/>

            <!-- ============================================== -->
            <!-- 侧边栏背景 - 基于 SideBarBackground 的深蓝渐变 -->
            <!-- ============================================== -->
            <LinearGradientBrush x:Key="Brush_SidebarBackground" StartPoint="0,0" EndPoint="1,0">
                <GradientStop Color="#2E110033" Offset="0"/>
                <GradientStop Color="#423579FF" Offset="0.473"/>
                <GradientStop Color="#2E0C0024" Offset="1"/>
            </LinearGradientBrush>

            <!-- ============================================== -->
            <!-- 侧边栏顶部标题区域 - 基于 SideBarTop -->
            <!-- ============================================== -->
            <LinearGradientBrush x:Key="Brush_SidebarTopBackground" StartPoint="0.5,0" EndPoint="0.5,1">
                <GradientStop Color="#FF5A5F6D" Offset="0.36"/>
                <GradientStop Color="#FF353A51" Offset="0.498"/>
                <GradientStop Color="#FF141B36" Offset="0.504"/>
                <GradientStop Color="#FF070918" Offset="0.706"/>
            </LinearGradientBrush>
            
            <!-- 顶部高光效果 -->
            <RadialGradientBrush x:Key="Brush_SidebarTopHighlight" RadiusX="0.4" RadiusY="1.3" Center="0.5,0" GradientOrigin="0.5,0">
                <GradientStop Color="#FF79B6EE" Offset="0"/>
                <GradientStop Color="#004D4D4D" Offset="1"/>
            </RadialGradientBrush>

            <!-- 底部高光效果 -->
            <RadialGradientBrush x:Key="Brush_SidebarTopBottomGlow" RadiusX="0.7" RadiusY="0.5" Center="0.5,1" GradientOrigin="0.5,1">
                <GradientStop Color="#FF43ACFF" Offset="0"/>
                <GradientStop Color="#004D4D4D" Offset="1"/>
            </RadialGradientBrush>
            
            <!-- 顶部边框画刷 -->
            <RadialGradientBrush x:Key="Brush_SidebarTopBorder" RadiusX="4.4" RadiusY="1" Center="0.5,-1.7" GradientOrigin="0.5,-1.7">
                <RadialGradientBrush.RelativeTransform>
                    <RotateTransform CenterX="0.5" CenterY="-1.7" Angle="90"/>
                </RadialGradientBrush.RelativeTransform>
                <GradientStop Color="#00FFFFFF" Offset="0"/>
                <GradientStop Color="#FFFFFFFF" Offset="1"/>
            </RadialGradientBrush>

            <!-- ============================================== -->
            <!-- 分组标题栏 - Aero 风格深色渐变 -->
            <!-- ============================================== -->
            <LinearGradientBrush x:Key="Brush_GroupHeaderBackground" StartPoint="0.5,0" EndPoint="0.5,1">
                <GradientStop Color="#FF4A5060" Offset="0"/>
                <GradientStop Color="#FF2A3040" Offset="0.5"/>
                <GradientStop Color="#FF1A2030" Offset="0.51"/>
                <GradientStop Color="#FF0A1020" Offset="1"/>
            </LinearGradientBrush>
            
            <!-- 分组标题高光 (激活状态) - Aero 蓝色发光 -->
            <RadialGradientBrush x:Key="Brush_GroupHeaderHighlight" RadiusX="1.5" RadiusY="0.8" Center="0.5,1" GradientOrigin="0.5,1">
                <GradientStop Color="#8040A0FF" Offset="0"/>
                <GradientStop Color="#0040A0FF" Offset="1"/>
            </RadialGradientBrush>
            
            <!-- 分组标题高光 (未激活状态) -->
            <RadialGradientBrush x:Key="Brush_GroupHeaderHighlightInactive" RadiusX="1.5" RadiusY="0.8" Center="0.5,1" GradientOrigin="0.5,1">
                <GradientStop Color="#3040A0FF" Offset="0"/>
                <GradientStop Color="#0040A0FF" Offset="1"/>
            </RadialGradientBrush>
            
            <!-- 分组标题边框 - Aero 玻璃边框 -->
            <LinearGradientBrush x:Key="Brush_GroupHeaderBorder" StartPoint="0.5,0" EndPoint="0.5,1">
                <GradientStop Color="#60FFFFFF" Offset="0"/>
                <GradientStop Color="#20FFFFFF" Offset="0.5"/>
                <GradientStop Color="#40FFFFFF" Offset="1"/>
            </LinearGradientBrush>

            <!-- ============================================== -->
            <!-- 侧边栏按钮项 - 基于 SideTabIdleRevised -->
            <!-- ============================================== -->
            <RadialGradientBrush x:Key="Brush_SidebarItemNormal" RadiusX="1.49" RadiusY="1.83" Center="0.188,-0.369" GradientOrigin="0.188,-0.369">
                <RadialGradientBrush.RelativeTransform>
                    <RotateTransform CenterX="0.188" CenterY="-0.369" Angle="90"/>
                </RadialGradientBrush.RelativeTransform>
                <GradientStop Color="#CCFFFFFF" Offset="0"/>
                <GradientStop Color="#2EFFFFFF" Offset="0.296"/>
                <GradientStop Color="#18242729" Offset="0.626"/>
                <GradientStop Color="#34FFFFFF" Offset="0.963"/>
            </RadialGradientBrush>
            
            <!-- 侧边栏按钮边框 -->
            <SolidColorBrush x:Key="Brush_SidebarItemBorder" Color="#7F7E8DB3"/>

            <!-- ============================================== -->
            <!-- 侧边栏按钮项选中 - 基于 SideBarSecondaryObjectActivatedRevised -->
            <!-- ============================================== -->
            <RadialGradientBrush x:Key="Brush_SidebarItemSelected" RadiusX="1.49" RadiusY="1.83" Center="0.188,-0.369" GradientOrigin="0.188,-0.369">
                <RadialGradientBrush.RelativeTransform>
                    <RotateTransform CenterX="0.188" CenterY="-0.369" Angle="90"/>
                </RadialGradientBrush.RelativeTransform>
                <GradientStop Color="#CCFFFFFF" Offset="0.201"/>
                <GradientStop Color="#B5CFEFFF" Offset="0.323"/>
                <GradientStop Color="#967A99A6" Offset="0.455"/>
                <GradientStop Color="#A501263F" Offset="0.678"/>
                <GradientStop Color="#BF5FCAFF" Offset="0.911"/>
                <GradientStop Color="#FF25CFFF" Offset="1"/>
            </RadialGradientBrush>

            <!-- ============================================== -->
            <!-- 底部导航栏按钮 - Aero 玻璃效果 -->
            <!-- ============================================== -->
            <LinearGradientBrush x:Key="Brush_BottomNavItem" StartPoint="0.5,0" EndPoint="0.5,1">
                <GradientStop Color="#FF707580" Offset="0"/>
                <GradientStop Color="#20FFFFFF" Offset="0.48"/>
                <GradientStop Color="#10101520" Offset="0.52"/>
                <GradientStop Color="#FF606570" Offset="1"/>
            </LinearGradientBrush>
            
            <!-- 底部导航栏按钮悬停 - Aero 蓝色 -->
            <LinearGradientBrush x:Key="Brush_BottomNavItemHover" StartPoint="0.5,0" EndPoint="0.5,1">
                <GradientStop Color="#FFD0E8FF" Offset="0"/>
                <GradientStop Color="#FF90B0D0" Offset="0.12"/>
                <GradientStop Color="#CF305080" Offset="0.45"/>
                <GradientStop Color="#FF103050" Offset="0.52"/>
                <GradientStop Color="#FF4090C0" Offset="1"/>
            </LinearGradientBrush>
            
            <!-- 底部导航栏边框 -->
            <SolidColorBrush x:Key="Brush_BottomNavBorder" Color="#607080A0"/>

            <!-- 内容区域背景 - GlassPlateRadial -->
            <DrawingBrush x:Key="Brush_ContentBackground" Stretch="Fill">
                <DrawingBrush.Drawing>
                    <DrawingGroup>
                        <DrawingGroup.Children>
                            <GeometryDrawing Geometry="F1 M 22,3.99988L 1122,3.99988C 1131.94,3.99988 1140,12.0588 1140,21.9999L 1140,454C 1140,463.941 1131.94,472 1122,472L 22,472C 12.0588,472 4,463.941 4,454L 4,21.9999C 4,12.0588 12.0588,3.99988 22,3.99988 Z ">
                                <GeometryDrawing.Pen>
                                    <Pen Thickness="8" StartLineCap="Round" EndLineCap="Round" LineJoin="Round">
                                        <Pen.Brush>
                                            <RadialGradientBrush RadiusX="1.72783" RadiusY="1.72269" Center="0.5,0.0168067" GradientOrigin="0.5,0.0168067">
                                                <RadialGradientBrush.GradientStops>
                                                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                                                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                                                </RadialGradientBrush.GradientStops>
                                            </RadialGradientBrush>
                                        </Pen.Brush>
                                    </Pen>
                                </GeometryDrawing.Pen>
                                <GeometryDrawing.Brush>
                                    <RadialGradientBrush RadiusX="1.74" RadiusY="1.75214" Center="0.5,0.00854701" GradientOrigin="0.5,0.00854701">
                                        <RadialGradientBrush.GradientStops>
                                            <GradientStop Color="#25FFFFFF" Offset="0"/>
                                            <GradientStop Color="#00FFFFFF" Offset="0.185299"/>
                                            <GradientStop Color="#1AFFFFFF" Offset="0.540582"/>
                                            <GradientStop Color="#FFFFFFFF" Offset="1"/>
                                        </RadialGradientBrush.GradientStops>
                                    </RadialGradientBrush>
                                </GeometryDrawing.Brush>
                            </GeometryDrawing>
                        </DrawingGroup.Children>
                    </DrawingGroup>
                </DrawingBrush.Drawing>
            </DrawingBrush>

            <!-- ============================================== -->
            <!-- 分组标题 Expander 样式 - Aero 风格 -->
            <!-- ============================================== -->
            <Style x:Key="SidebarExpanderStyle" TargetType="Expander">
                <Setter Property="Foreground" Value="#FFFFFFFF"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="FontWeight" Value="Normal"/>
                <Setter Property="Margin" Value="0,2"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Expander">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- 分组标题栏 -->
                                <ToggleButton x:Name="HeaderToggle" 
                                              Grid.Row="0" 
                                              IsChecked="{Binding IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                              Height="28">
                                    <ToggleButton.Template>
                                        <ControlTemplate TargetType="ToggleButton">
                                            <Grid>
                                                <!-- 背景层 -->
                                                <Border x:Name="BgBorder" 
                                                        Background="{StaticResource Brush_GroupHeaderBackground}" 
                                                        BorderThickness="1" 
                                                        BorderBrush="{StaticResource Brush_GroupHeaderBorder}"
                                                        CornerRadius="3"/>
                                                <!-- 高光层 -->
                                                <Border x:Name="HighlightBorder" 
                                                        Background="{StaticResource Brush_GroupHeaderHighlightInactive}" 
                                                        CornerRadius="3"
                                                        Opacity="0.5"/>
                                                <!-- 顶部玻璃高光 -->
                                                <Border CornerRadius="3,3,0,0" Height="14" VerticalAlignment="Top">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                                            <GradientStop Color="#30FFFFFF" Offset="0"/>
                                                            <GradientStop Color="#00FFFFFF" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                </Border>
                                
                                                <Grid Margin="10,0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <!-- Header 文字 -->
                                                    <TextBlock Grid.Column="0" 
                                                               Text="{Binding Header, RelativeSource={RelativeSource AncestorType=Expander}}"
                                                               VerticalAlignment="Center"
                                                               Foreground="#FFFFFFFF"
                                                               FontWeight="Normal"
                                                               FontSize="13"/>
                                                    <!-- 展开箭头 (向上) -->
                                                    <Path x:Name="ArrowExpanded" Grid.Column="1" 
                                                          Data="M 0 5 L 5 0 L 10 5" 
                                                          Stroke="White" StrokeThickness="1.5" 
                                                          VerticalAlignment="Center" 
                                                          HorizontalAlignment="Right"
                                                          Opacity="0.8"
                                                          Visibility="Collapsed"/>
                                                    <!-- 折叠箭头 (向下) -->
                                                    <Path x:Name="ArrowCollapsed" Grid.Column="1" 
                                                          Data="M 0 0 L 5 5 L 10 0" 
                                                          Stroke="White" StrokeThickness="1.5" 
                                                          VerticalAlignment="Center" 
                                                          HorizontalAlignment="Right"
                                                          Opacity="0.8"
                                                          Visibility="Visible"/>
                                                </Grid>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsChecked" Value="True">
                                                    <Setter TargetName="ArrowExpanded" Property="Visibility" Value="Visible"/>
                                                    <Setter TargetName="ArrowCollapsed" Property="Visibility" Value="Collapsed"/>
                                                    <Setter TargetName="HighlightBorder" Property="Background" Value="{StaticResource Brush_GroupHeaderHighlight}"/>
                                                    <Setter TargetName="HighlightBorder" Property="Opacity" Value="0.7"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="HighlightBorder" Property="Opacity" Value="0.9"/>
                                                    <Setter TargetName="ArrowExpanded" Property="Opacity" Value="1"/>
                                                    <Setter TargetName="ArrowCollapsed" Property="Opacity" Value="1"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </ToggleButton.Template>
                                </ToggleButton>
                                
                                <!-- 内容区域 -->
                                <Border x:Name="ContentBorder" Grid.Row="1" Visibility="Collapsed" Padding="3,5">
                                    <ContentPresenter/>
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsExpanded" Value="True">
                                    <Setter TargetName="ContentBorder" Property="Visibility" Value="Visible"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ============================================== -->
            <!-- 侧边栏按钮项样式 - Aero 风格 -->
            <!-- ============================================== -->
            <Style x:Key="SidebarItemStyle" TargetType="ListBoxItem">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Margin" Value="0,1"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ListBoxItem">
                            <Grid x:Name="RootGrid" Height="30">
                                <!-- 背景边框 -->
                                <Border x:Name="BgBorder" 
                                        Background="{StaticResource Brush_SidebarItemNormal}" 
                                        BorderBrush="{StaticResource Brush_SidebarItemBorder}"
                                        BorderThickness="1"
                                        CornerRadius="3"
                                        Opacity="0.9"/>
                                <!-- 顶部玻璃高光 -->
                                <Border x:Name="GlassHighlight" 
                                        CornerRadius="3,3,0,0" 
                                        Height="15" 
                                        VerticalAlignment="Top"
                                        Opacity="0.6">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                            <GradientStop Color="#40FFFFFF" Offset="0"/>
                                            <GradientStop Color="#00FFFFFF" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                </Border>
                                <!-- 内容 -->
                                <ContentPresenter HorizontalAlignment="Center" 
                                                  VerticalAlignment="Center" 
                                                  TextElement.Foreground="White"
                                                  TextElement.FontSize="13"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="BgBorder" Property="Background" Value="{StaticResource Brush_SidebarItemSelected}"/>
                                    <Setter TargetName="BgBorder" Property="BorderBrush" Value="#8060A0FF"/>
                                    <Setter TargetName="BgBorder" Property="Opacity" Value="1"/>
                                    <Setter TargetName="GlassHighlight" Property="Opacity" Value="0.8"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="BgBorder" Property="Opacity" Value="1"/>
                                    <Setter TargetName="GlassHighlight" Property="Opacity" Value="0.8"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ============================================== -->
            <!-- 底部导航栏按钮样式 - Aero 风格 -->
            <!-- ============================================== -->
            <Style x:Key="BottomNavButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource Brush_BottomNavItem}"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="Height" Value="26"/>
                <Setter Property="Margin" Value="0,1"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid>
                                <Border x:Name="BgBorder" 
                                        Background="{TemplateBinding Background}" 
                                        BorderBrush="{StaticResource Brush_BottomNavBorder}"
                                        BorderThickness="1"
                                        CornerRadius="2"/>
                                <!-- 顶部玻璃高光 -->
                                <Border CornerRadius="2,2,0,0" Height="13" VerticalAlignment="Top">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                            <GradientStop Color="#35FFFFFF" Offset="0"/>
                                            <GradientStop Color="#00FFFFFF" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                </Border>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0">
                                    <ContentPresenter x:Name="IconPresenter" 
                                                      Content="{TemplateBinding Tag}" 
                                                      VerticalAlignment="Center"
                                                      Margin="0,0,8,0"/>
                                    <ContentPresenter VerticalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="BgBorder" Property="Background" Value="{StaticResource Brush_BottomNavItemHover}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="BgBorder" Property="Opacity" Value="0.85"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 玻璃按钮样式 (GlassButtom) -->
            <DrawingBrush x:Key="Brush_GlassButton" Stretch="Fill">
                <DrawingBrush.Drawing>
                    <DrawingGroup>
                        <DrawingGroup.Children>
                            <GeometryDrawing Geometry="F1 M 3.5,0.500015L 1141.5,0.500015C 1143.16,0.500015 1144.5,1.84315 1144.5,3.50002L 1144.5,560.502C 1144.5,562.159 1143.16,563.502 1141.5,563.502L 3.5,563.502C 1.84308,563.502 0.5,562.159 0.5,560.502L 0.5,3.50002C 0.5,1.84315 1.84308,0.500015 3.5,0.500015 Z ">
                                <GeometryDrawing.Pen>
                                    <Pen LineJoin="Round" Brush="#7F7E8DB3"/>
                                </GeometryDrawing.Pen>
                                <GeometryDrawing.Brush>
                                    <LinearGradientBrush StartPoint="0.5,-0.405855" EndPoint="0.5,1.40585">
                                        <LinearGradientBrush.GradientStops>
                                            <GradientStop Color="#FF8F939C" Offset="0.130168"/>
                                            <GradientStop Color="#00FFFFFF" Offset="0.513017"/>
                                            <GradientStop Color="#00191F34" Offset="0.519142"/>
                                            <GradientStop Color="#FFA0A0A0" Offset="0.981623"/>
                                        </LinearGradientBrush.GradientStops>
                                    </LinearGradientBrush>
                                </GeometryDrawing.Brush>
                            </GeometryDrawing>
                        </DrawingGroup.Children>
                    </DrawingGroup>
                </DrawingBrush.Drawing>
            </DrawingBrush>
    
            <!-- JadeButton 风格 (JadeBall/JadeBar) -->
            <DrawingBrush x:Key="Brush_JadeButton" Stretch="Fill">
                <DrawingBrush.Drawing>
                    <DrawingGroup>
                        <DrawingGroup.Children>
                            <GeometryDrawing Geometry="F1 M 0.5,0.5L 318.5,0.5L 318.5,68.5L 0.5,68.5L 0.5,0.5 Z ">
                                <GeometryDrawing.Pen>
                                    <Pen LineJoin="Round" Brush="#FFA0ABB9"/>
                                </GeometryDrawing.Pen>
                                <GeometryDrawing.Brush>
                                    <LinearGradientBrush StartPoint="0.500001,-1.84558" EndPoint="0.500001,2.84559">
                                        <LinearGradientBrush.GradientStops>
                                            <GradientStop Color="#FFE4EAF8" Offset="0.323124"/>
                                            <GradientStop Color="#FFA9B0BE" Offset="0.356815"/>
                                            <GradientStop Color="#CF28536E" Offset="0.482389"/>
                                            <GradientStop Color="#FF01263F" Offset="0.49464"/>
                                            <GradientStop Color="#FF4C9EC0" Offset="0.620214"/>
                                        </LinearGradientBrush.GradientStops>
                                    </LinearGradientBrush>
                                </GeometryDrawing.Brush>
                            </GeometryDrawing>
                        </DrawingGroup.Children>
                    </DrawingGroup>
                </DrawingBrush.Drawing>
            </DrawingBrush>

            <!-- Button 样式已移至全局隐式样式 (AeroImplicitStyles.xaml) -->
        </ResourceDictionary>
    </UserControl.Resources>


    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧侧边栏 -->
        <Border Grid.Column="0" Margin="10,20,0,20" CornerRadius="6" ClipToBounds="True">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#25102040" Offset="0"/>
                    <GradientStop Color="#354080C0" Offset="0.5"/>
                    <GradientStop Color="#25102040" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.BorderBrush>
                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                    <GradientStop Color="#50FFFFFF" Offset="0"/>
                    <GradientStop Color="#20FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#40FFFFFF" Offset="1"/>
                </LinearGradientBrush>
            </Border.BorderBrush>
            <Border.BorderThickness>1</Border.BorderThickness>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- 顶部标题 -->
                    <RowDefinition Height="*"/>     <!-- 分组内容 -->
                    <RowDefinition Height="Auto"/>  <!-- 分隔线 -->
                    <RowDefinition Height="Auto"/>  <!-- 底部导航 -->
                </Grid.RowDefinitions>
                
                <!-- 顶部标题区域 -->
                <Grid Grid.Row="0" Height="38">
                    <!-- 背景层 -->
                    <Border Background="{StaticResource Brush_SidebarTopBackground}" 
                            BorderBrush="{StaticResource Brush_SidebarTopBorder}" 
                            BorderThickness="1" 
                            CornerRadius="5,5,0,0"/>
                    <!-- 顶部高光 -->
                    <Border Background="{StaticResource Brush_SidebarTopHighlight}" CornerRadius="5,5,0,0"/>
                    <!-- 底部高光 -->
                    <Border Background="{StaticResource Brush_SidebarTopBottomGlow}" CornerRadius="5,5,0,0"/>
                    
                    <TextBlock Text="{DynamicResource Operations_Title}" 
                               FontSize="14" FontWeight="SemiBold" 
                               Foreground="White" 
                               VerticalAlignment="Center"
                               Margin="12,0"
                               Effect="{x:Null}"/>
                </Grid>

                <!-- 分组内容区域 - 绑定到OperationsViewModel.Groups -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="5,5,5,0">
                    <ItemsControl ItemsSource="{Binding Groups}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vmOps:OperationGroupViewModel}">
                                <Expander Header="{Binding DisplayName}" 
                                          IsExpanded="{Binding IsExpanded, Mode=TwoWay}" 
                                          Style="{StaticResource SidebarExpanderStyle}">
                                    <!-- 子页面列表 -->
                                    <Grid>
                                        <!-- 当有子页面时显示列表 -->
                                        <ItemsControl ItemsSource="{Binding SubPages}"
                                                      Visibility="{Binding SubPages.Count, Converter={StaticResource CountToVisibilityConverter}, FallbackValue=Collapsed}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate DataType="{x:Type vmOps:SelectableSubPageViewModel}">
                                                    <Border x:Name="ItemBorder"
                                                            Background="{StaticResource Brush_SidebarItemNormal}" 
                                                            BorderBrush="{StaticResource Brush_SidebarItemBorder}"
                                                            BorderThickness="1"
                                                            CornerRadius="3"
                                                            Opacity="0.9"
                                                            Height="30"
                                                            Margin="0,1"
                                                            Cursor="Hand"
                                                            MouseLeftButtonUp="SubPageItem_Click"
                                                            RenderTransformOrigin="0.5,0.5">
                                                        <Border.RenderTransform>
                                                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                                                        </Border.RenderTransform>
                                                        <Grid>
                                                            <!-- 顶部玻璃高光 -->
                                                            <Border x:Name="GlassHighlight" 
                                                                    CornerRadius="3,3,0,0" 
                                                                    Height="15" 
                                                                    VerticalAlignment="Top"
                                                                    Opacity="0.6">
                                                                <Border.Background>
                                                                    <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                                                        <GradientStop Color="#40FFFFFF" Offset="0"/>
                                                                        <GradientStop Color="#00FFFFFF" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Border.Background>
                                                            </Border>
                                                            <!-- 内容 -->
                                                            <TextBlock Text="{Binding DisplayName}" 
                                                                       HorizontalAlignment="Center" 
                                                                       VerticalAlignment="Center"
                                                                       Foreground="White"
                                                                       FontSize="13"/>
                                                        </Grid>
                                                    </Border>
                                                    <DataTemplate.Triggers>
                                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                            <Setter TargetName="ItemBorder" Property="Background" Value="{StaticResource Brush_SidebarItemSelected}"/>
                                                            <Setter TargetName="ItemBorder" Property="BorderBrush" Value="#8060A0FF"/>
                                                            <Setter TargetName="ItemBorder" Property="Opacity" Value="1"/>
                                                            <Setter TargetName="GlassHighlight" Property="Opacity" Value="0.8"/>
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <!-- 选中时的缩放动画 -->
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
                                                                                       To="1.02" Duration="0:0:0.15">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)"
                                                                                       To="1.02" Duration="0:0:0.15">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <!-- 透明度动画 -->
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="Opacity"
                                                                                       To="1" Duration="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <CubicEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                            <DataTrigger.ExitActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <!-- 取消选中时恢复 -->
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
                                                                                       To="1" Duration="0:0:0.15">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)"
                                                                                       To="1" Duration="0:0:0.15">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.ExitActions>
                                                        </DataTrigger>
                                                        <Trigger SourceName="ItemBorder" Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ItemBorder" Property="Opacity" Value="1"/>
                                                            <Setter TargetName="GlassHighlight" Property="Opacity" Value="0.8"/>
                                                            <Trigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <!-- 悬停时的轻微缩放 -->
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
                                                                                       To="1.01" Duration="0:0:0.12">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)"
                                                                                       To="1.01" Duration="0:0:0.12">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.EnterActions>
                                                            <Trigger.ExitActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <!-- 离开悬停时恢复 -->
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
                                                                                       To="1" Duration="0:0:0.12">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetName="ItemBorder"
                                                                                       Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)"
                                                                                       To="1" Duration="0:0:0.12">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.ExitActions>
                                                        </Trigger>
                                                    </DataTemplate.Triggers>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        <!-- 当无子页面时显示提示 -->
                                        <TextBlock Text="{DynamicResource Operations_NoSubPages}" 
                                                   Foreground="#80FFFFFF" 
                                                   FontSize="12"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,8"
                                                   Visibility="{Binding SubPages.Count, Converter={StaticResource CountToInverseVisibilityConverter}, FallbackValue=Visible}"/>
                                    </Grid>
                                </Expander>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                
                <!-- 分隔线区域 (带拖动点) -->
                <Grid Grid.Row="2" Height="16">
                    <Border Background="#15000000" BorderThickness="0,1,0,0" BorderBrush="#30FFFFFF"/>
                    <TextBlock Text="· · · · ·" HorizontalAlignment="Center" VerticalAlignment="Center" 
                               Foreground="#50FFFFFF" FontSize="10"/>
                </Grid>
                
                <!-- 底部导航栏 -->
                <StackPanel Grid.Row="3" Margin="5,3,5,8">
                    <Button Command="{Binding OpenPresetManagementCommand}" Style="{StaticResource BottomNavButtonStyle}">
                        <Button.Content>
                            <TextBlock>
                                <Run Text="{DynamicResource Operations_PresetManagement}"/>
                                <Run Text="..."/>
                            </TextBlock>
                        </Button.Content>
                        <Button.Tag>
                            <Ellipse Width="14" Height="14" Fill="#6090D0"/>
                        </Button.Tag>
                    </Button>
                    <Button Command="{Binding AddAsPresetCommand}" Style="{StaticResource BottomNavButtonStyle}">
                        <Button.Tag>
                            <Rectangle Width="12" Height="10" Fill="#7090B0"/>
                        </Button.Tag>
                        <Button.Content>
                            <TextBlock Text="{DynamicResource Operations_AddAsPreset}"/>
                        </Button.Content>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>


        <!-- 右侧内容区域 -->
        <Border Grid.Column="1" Margin="10,20,20,20" Background="{DynamicResource AeroTabNormalBrush}" CornerRadius="0" Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- 标题区域 -->
                    <RowDefinition Height="*"/>    <!-- 内容区域 -->
                </Grid.RowDefinitions>

                <!-- 标题区域 - 显示当前子页面名称 -->
                <TextBlock Grid.Row="0"
                           Text="{Binding CurrentSubPageName, TargetNullValue='操作页面'}" 
                           FontSize="18" 
                           Foreground="#FFEBEBEB" 
                           Margin="0,0,0,20" 
                           Effect="{x:Null}"
                           Visibility="{Binding CurrentSubPageName, Converter={StaticResource NullToCollapsedConverter}, FallbackValue=Collapsed}"/>

                <!-- 内容区域 - 绑定到CurrentView，带Aero风格动画 -->
                <ContentControl Grid.Row="1" 
                                Content="{Binding CurrentView}"
                                helpers:ContentSwitchAnimationBehavior.IsEnabled="True">
                    <ContentControl.Style>
                        <Style TargetType="ContentControl">
                            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            <Setter Property="RenderTransform">
                                <Setter.Value>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentView}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ContentControl.Style>
                </ContentControl>

                <!-- 欢迎信息 - 当无子页面选中时显示 -->
                <Grid Grid.Row="0" Grid.RowSpan="2" 
                      Visibility="{Binding CurrentView, Converter={StaticResource NullToVisibleConverter}, FallbackValue=Visible}">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="{DynamicResource Operations_Welcome}" 
                                   FontSize="24" 
                                   Foreground="#555"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,15"/>
                        <TextBlock Text="{DynamicResource Operations_SelectSubPage}" 
                                   FontSize="14" 
                                   Foreground="#888"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,30"/>
                        <TextBlock Text="{DynamicResource Operations_RegisteredGroups}" 
                                   FontSize="12" 
                                   Foreground="#666"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,8"/>
                        <ItemsControl ItemsSource="{Binding Groups}" HorizontalAlignment="Center">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayName}" 
                                               FontSize="12" 
                                               Foreground="#777"
                                               HorizontalAlignment="Center"
                                               Margin="0,2"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>